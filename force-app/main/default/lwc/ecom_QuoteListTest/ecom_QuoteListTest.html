<template>
  <div class="ecomm slds-p-around_medium">
    <!-- Page Header -->
    <header class="slds-grid slds-wrap slds-m-bottom_small slds-grid_vertical-align-center">
      <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
        <h1 class="slds-text-heading_large slds-m-bottom_small">Quotes</h1>
      </div>

      <!-- Segmented pill made of two buttons -->
      <div class="seg-switch slds-m-bottom_small" role="group" aria-label="Quote status">
        <button type="button" class="seg-btn is-active" data-segment="active" aria-pressed="true" onclick={handleActiveQuotes}>
          Active Quotes
        </button>

        <button type="button" class="seg-btn is-inactive" data-segment="expired" aria-pressed="false" onclick={handleExpiredQuotes}>
          Expired Quotes
        </button>
      </div>
    </header>

    <!-- Toolbar container -->
    <div class="slds-grid slds-wrap slds-m-vertical_medium">

      <!-- ===== Row 1: "Find a quote" (right aligned, its own row) ===== -->
      <div class="slds-col slds-size_1-of-1 slds-text-align_right slds-m-bottom_small">
        <a href="javascript:void(0)" class="ecomm-link">
          <span class="slds-icon_container slds-icon-utility-search ecomm-inline-icon slds-m-right_x-small"
            title="Search" aria-hidden="true"></span>
          Find a quote
        </a>
      </div>

      <!-- ===== Row 2: Count (left) + Sort combobox (right) ===== -->
      <div class="slds-col slds-size_1-of-1">
        <div class="slds-grid slds-wrap slds-grid_vertical-align-center">

          <!-- Left column: Count -->
          <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
            <template if:true={isQuoteHistoryPage}>
              <p class="slds-m-bottom_none slds-m-top_x-small">
                <template if:true={totalQuotes}>
                  <span class="slds-text-heading_small slds-m-right_x-small">
                    <span if:true={fromRecords}>{fromRecords}-</span>{toRecords}
                  </span>
                  <span class="slds-text-heading_small slds-m-right_x-small">out of {totalQuotes} Quotes</span>
                </template>
              </p>
            </template>
          </div>

          <!-- Right column: Sort combobox (right-aligned, compact width) -->
          <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-text-align_right">
            <template if:true={isQuoteHistoryPage}>
              <div class="slds-grid slds-grid_align-end">
                <div
                  class="slds-form slds-form_horizontal slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_5-of-12">
                  <lightning-combobox name="Sort" label="Sort" value={sortValue} placeholder="Sort by:"
                    options={sortOption} variant="label-hidden" onchange={handleSortChange}>
                  </lightning-combobox>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- Quote List -->
    <template for:each={quotesToDisplay} for:item="quote">
      <div key={quote.quoteNumber} class="slds-card ecomm-card slds-m-bottom_small">
        <div class="slds-card__header slds-grid">
          <header class="slds-media slds-media_center slds-has-flexi-truncate">
            <h2 class="slds-card__header-title">
              <span class="slds-truncate" title={quote.quoteNumber}>
                <strong>Quote number: </strong> <span class="ecomm-number">{quote.quoteNumber}</span>
              </span>
            </h2>
          </header>
          <button type="button" class="btn-primary">
            Add quote to Cart
          </button>
        </div>

        <div class="slds-card__body slds-card__body_inner">
          <div class="slds-grid slds-wrap slds-gutters">
            <div class="slds-col slds-size_1-of-1 slds-small-size_1-of-2 slds-medium-size_1-of-5">
              <div class="ecomm-label">Valid until</div>
              <div class={quote.statusClass}>{quote.expiresOn}</div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-small-size_1-of-2 slds-medium-size_1-of-5">
              <div class="ecomm-label">Total</div>
              <div class="ecomm-value">{quote.totalAmount}</div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-small-size_1-of-2 slds-medium-size_1-of-5">
              <div class="ecomm-label">Items</div>
              <div class="ecomm-value">{quote.items}</div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-small-size_1-of-2 slds-medium-size_1-of-5">
              <div class="ecomm-label">Status</div>
              <div class={quote.statusClass}>{quote.status}</div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-small-size_1-of-2 slds-medium-size_1-of-5">
              <a href="javascript:void(0)" class="ecomm-link">View quote details</a>
            </div>
          </div>
        </div>
      </div>
    </template>

    <!-- Paginator -->
    <!-- <div class="slds-m-top_large">
      <template if:true={isLoadMoreEnabled}>
        <div class="slds-grid slds-wrap">
          <div class="slds-col slds-size_1-of-1">
            <c-ecom_paginator ongotopage={pageChanged} page-size={defaultListSize}
              current-page-number={currentPageNumber} total-records={totalQuotes}></c-ecom_paginator>
          </div>
        </div>
      </template>
    </div> -->

    <div class="slds-m-top_large">
      <template if:true={isLoadMoreEnabled}>
        <div class="slds-grid slds-wrap">
          <div class="slds-col slds-size_1-of-1">
            <c-ecom_-quote-paginator ongotopage={pageChanged} page-size={defaultListSize}
              current-page-number={currentPageNumber} total-records={totalQuotes}></c-ecom_-quote-paginator>
          </div>
        </div>
      </template>
    </div>
  </div>
</template>